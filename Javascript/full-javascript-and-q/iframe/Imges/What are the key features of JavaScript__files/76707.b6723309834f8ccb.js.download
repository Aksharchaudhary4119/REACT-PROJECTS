"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76707],{57467:function(a,b,c){c.d(b,{Dc:function(){return l},NU:function(){return h},Oc:function(){return k},PO:function(){return g},rb:function(){return j},tn:function(){return f},xI:function(){return i}});var d=c(10308);function e(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var f=function(a){var b=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,d.Z)(function(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{},d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){e(a,b,c[b])})}return a}({url:"/api/user/gamification/streak".concat(a?"":"?timezone=".concat(b)),type:a?"PUT":"GET"},a&&{data:{timezone:b,increment_streak:a}}))},g=function(a){var b=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,d.Z)({url:"/api/user/gamification/monthly-streak?month_range=".concat(a,"&timezone=").concat(b),type:"GET"})},h=function(){var a=arguments.length>0&& void 0!==arguments[0]&&arguments[0];return(0,d.Z)({url:"/api/learning-tracker",type:a?"POST":"GET"})},i=function(a){var b=Intl.DateTimeFormat().resolvedOptions().timeZone;return(0,d.Z)({url:"/api/learning-tracker/set-goal",type:"POST",data:{goal:a,timezone:b}})},j=function(){return(0,d.Z)({url:"/api/learning-tracker",type:"DELETE"})},k=function(a,b){var c,e,f,g,h,i;return(0,d.Z)({url:"/api/learning-tracker/reminder/set",type:"POST",data:{reminder_time:(e=(c=a).getFullYear(),f=("0"+(c.getMonth()+1)).slice(-2),g=("0"+c.getDate()).slice(-2),h=("0"+c.getHours()).slice(-2),i=("0"+c.getMinutes()).slice(-2),e+"-"+f+"-"+g+" "+h+":"+i+":00"),reminder_weekdays:JSON.stringify(b)}})},l=function(){return(0,d.Z)({url:"/api/learning-tracker/reminder/disable",type:"POST"})}},58431:function(a,b,c){c.d(b,{I:function(){return e},Q6:function(){return f},sR:function(){return d}});var d=864e5,e=function(a,b){if(!(a&&b))return 0;var c=a;c.setHours(0,0,0,0);var e=b;return e.setHours(0,0,0,0),(e.getTime()-c.getTime())/d},f=function(a){return e(a,new Date)+1}},36049:function(a,b,c){c.d(b,{"$E":function(){return d},X9:function(){return e},Yi:function(){return m},"_O":function(){return n},kZ:function(){return g},p3:function(){return l},rS:function(){return f}});var d,e,f,g,h,i,j,k,l=[{day:"Sunday",abbreviation:"Su"},{day:"Monday",abbreviation:"M"},{day:"Tuesday",abbreviation:"Tu"},{day:"Wednesday",abbreviation:"W"},{day:"Thursday",abbreviation:"Th"},{day:"Friday",abbreviation:"F"},{day:"Saturday",abbreviation:"Sa"},],m=["January","February","March","April","May","June","July","August","September","October","November","December",];(h=d||(d={}))[h.ACTIVE=9e3]="ACTIVE",h[h.BROKEN=9001]="BROKEN",h[h.FROZEN=9002]="FROZEN",h[h.FIRST_BREAK_INTACT=9003]="FIRST_BREAK_INTACT",(i=e||(e={}))[i.UNINITIALIZED=-1]="UNINITIALIZED",i[i.FIRST_STREAK=0]="FIRST_STREAK",(j=f||(f={}))[j.NONE=0]="NONE",j[j.NEXT_LESSON=1]="NEXT_LESSON",j[j.CURRENT_LESSON=2]="CURRENT_LESSON",(k=g||(g={}))[k.HEADER=0]="HEADER",k[k.INCREMENT=1]="INCREMENT",k[k.FIRST_BREAK_INTACT=2]="FIRST_BREAK_INTACT",k[k.USER_FEEDBACK=3]="USER_FEEDBACK";var n='<div class="flex flex-col"><span>Disabling the feature will break your current streak.</span><span class="pt-2">Note: Your current streak will be restored if you reactivate within next day.</span><div/>'},76707:function(a,b,c){c.r(b),c.d(b,{UserGamificationContext:function(){return v},default:function(){return w},learningTrackerInitialState:function(){return u},userGamificationInitialState:function(){return t}});var d=c(66729),e=c(83249),f=c(10308),g=c(57467),h=c(58431),i=c(36049),j=c(71653),k=c(88674),l=c(79098),m=c(28399);function n(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function o(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function p(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{},d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){o(a,b,c[b])})}return a}function q(a,b){return b=null!=b?b:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):(function(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);c.push.apply(c,d)}return c})(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))}),a}function r(a){return function(a){if(Array.isArray(a))return n(a)}(a)||function(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}(a)||s(a)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(a,b){if(a){if("string"==typeof a)return n(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return n(a,b)}}var t={data:{},error:"",loading:!1,loaded:!1,learningTrackerLoading:!0},u={reminderActive:!1,reminderTime:null,reminderDays:[],weeklyGoals:[]},v=e.createContext({value:t,clearState:function(){},load:function(a,b){},incrementStreak:function(a){a.userInfo,a.userGamificationFeatureFlag},setStreakTour:function(){arguments.length>0&& void 0!==arguments[0]&&arguments[0]},updateMonthlyStreaks:function(a){a.monthRange,a.monthData,a.endDate,a.clear},updateStreakIncrementedFlag:function(a){},updateEnableStreaksFlag:function(a){},isStreakInfoOutdated:function(){return!1},setLearningTrackerGoal:function(a){},deleteLearningTracker:function(){},setLearningTrackerReminder:function(a,b){},disableLearningTrackerReminder:function(){}}),w=function(a){var b,c,n,w=a.children,x=a.initialState,y=(c=e.useState(void 0===x?t:x),n=2,function(a){if(Array.isArray(a))return a}(c)||function(a,b){var c,d,e=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=e){var f=[],g=!0,h=!1;try{for(e=e.call(a);!(g=(c=e.next()).done)&&(f.push(c.value),!b||f.length!==b);g=!0);}catch(i){h=!0,d=i}finally{try{g||null==e.return||e.return()}finally{if(h)throw d}}return f}}(c,n)||s(c,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),z=y[0],A=y[1],B=function(){return A(function(a){return q(p({},a),{learningTrackerLoading:!0})})},C=function(a){var b;A(function(c){var d,e,f,g,h,j,k,l,m,n,s,t,u,v,w;return q(p({},c),{data:{userGamification:q(p({},c.data.userGamification),{streakRevision:a.user_gamification.streak_revision,viewedStreakTour:a.user_gamification.viewed_streak_tour,viewedIncrementTour:a.user_gamification.viewed_increment_tour,viewedFirstIntactTour:a.user_gamification.viewed_first_intact_tour,viewedUserFeedbackTour:a.user_gamification.viewed_user_feedback_tour,firstIntactUse:new Date(a.user_gamification.first_intact_use),enableStreaks:a.user_gamification.enable_streaks,userStreak:{count:a.user_streak.count||0,status:a.user_streak.status||i.$E.BROKEN,monthsSpan:a.user_streak.months_span||[],lastUpdated:a.user_streak.last_updated,streakIncremented:a.streak_incremented,monthlyData:{data:p({},null===(d=c.data)|| void 0===d?void 0:null===(e=d.userGamification)|| void 0===e?void 0:null===(f=e.userStreak)|| void 0===f?void 0:null===(g=f.monthlyData)|| void 0===g?void 0:g.data,a.streak_incremented?o({},(w=new Date(a.user_streak.last_updated),"".concat(w.toLocaleString("default",{month:"2-digit"}),"-").concat(w.toLocaleString("default",{day:"2-digit"}),"-").concat(w.getFullYear())),i.$E.ACTIVE):{}),endDate:null===(h=c.data)|| void 0===h?void 0:null===(j=h.userGamification)|| void 0===j?void 0:null===(k=j.userStreak)|| void 0===k?void 0:null===(l=k.monthlyData)|| void 0===l?void 0:l.endDate,queriedMonths:new Set(r(Array.from(null!==(b=null===(m=c.data)|| void 0===m?void 0:null===(n=m.userGamification)|| void 0===n?void 0:null===(s=n.userStreak)|| void 0===s?void 0:null===(t=s.monthlyData)|| void 0===t?void 0:t.queriedMonths)&& void 0!==b?b:[])))}},longestStreak:a.user_gamification.longest_streak,lastFetchTime:new Date,learningTracker:null===(u=c.data)|| void 0===u?void 0:null===(v=u.userGamification)|| void 0===v?void 0:v.learningTracker})},loading:!1,loaded:!0,error:""})})},D=function(a){var b={reminderActive:a.reminder_active,reminderTime:a.reminder_time?new Date(a.reminder_time):null,reminderDays:a.reminder_weekdays,weeklyGoals:a.weekly_goals.map(function(a){var b=JSON.parse(a);return{startDate:new Date(b.start_date_utc),completedWeekdays:b.completed_weekdays,weeklyTarget:b.weekly_target,deleted:b.deleted}})};A(function(a){return q(p({},a),{data:{userGamification:q(p({},a.data.userGamification),{learningTracker:b})},learningTrackerLoading:!1})})},E=function(){A(function(a){return q(p({},a),{learningTrackerLoading:!1})})},F=function(a){B(),(0,g.xI)(a).then(function(a){D(JSON.parse(a))}).catch(function(){return E()})},G=function(){B(),(0,g.rb)().then(function(){A(function(a){return q(p({},a),{data:{userGamification:q(p({},a.data.userGamification),{learningTracker:u})},learningTrackerLoading:!1})})}).catch(function(){return E()})},H=function(a,b){B(),(0,g.Oc)(a,b).then(function(a){D(JSON.parse(a))}).catch(function(){return E()})},I=function(){B(),(0,g.Dc)().then(function(a){D(JSON.parse(a))}).catch(function(){return E()})},J=function(a,b){var c,d,e,f,g,h;return null!=a&&!!a.user_id&&(!z.loaded||null!==(c=z.data.userGamification)&& void 0!==c&&!!c.enableStreaks)&&(0,j.nOq)(b,null==a?void 0:null===(d=a.email)|| void 0===d?void 0:d.endsWith("educative.io"),(0,l.s)(a))&&(!(null===(e=z.data.userGamification)|| void 0===e?void 0:null===(f=e.userStreak)|| void 0===f?void 0:f.lastUpdated)||new Date().setHours(1,0,0,0)>new Date(null===(g=z.data.userGamification)|| void 0===g?void 0:null===(h=g.userStreak)|| void 0===h?void 0:h.lastUpdated).setHours(1,0,0,0))},K=function(a,b){if(!(null==a?void 0:a.user_id)||!(0,j.nOq)(b,null==a?void 0:null===(c=a.email)|| void 0===c?void 0:c.endsWith("educative.io"),(0,l.s)(a)))return!1;var c,d,e=null===(d=z.data.userGamification)|| void 0===d?void 0:d.learningTracker;if(!(null==e?void 0:e.weeklyGoals.length))return!0;var f=e.weeklyGoals,g=f[f.length-1],i=(0,h.I)(new Date(g.startDate),new Date);return!g.completedWeekdays.includes(i)},L=function(a,b,c){var d=arguments.length>3&& void 0!==arguments[3]?arguments[3]:function(){};K(a,c)&&(B(),(0,g.NU)(b).then(function(a){D(JSON.parse(a))}).catch(function(a){404===a.status?A(function(a){return q(p({},a),{data:{userGamification:q(p({},a.data.userGamification),{learningTracker:u})},learningTrackerLoading:!1})}):E()})),J(a,c)?(A(function(a){return q(p({},a),{loading:!0,loaded:!1})}),(0,g.tn)(b).then(function(a){C(JSON.parse(a)),null==d||d()}).catch(function(a){var b;return b=a,A(function(a){return q(p({},a),{loading:!1,loaded:!1,error:(0,m.nU)(b)})})})):d&&d(!1)},M=function(a){z.loaded&&A(function(b){return q(p({},b),{data:q(p({},b.data),{userGamification:q(p({},b.data.userGamification),{enableStreaks:a})})})})},N=function(a){var b;M(a),(b=a,(0,f.Z)({url:"/api/user/gamification/enable-streaks",type:"PUT",data:{enable_streaks:b}})).then(function(){return(0,k.qP)(k.f2.LEARNING_STREAKS,a?k.bt.CLICKED_TURNON_STREAK:k.bt.CLICKED_TURNOFF_STREAK)}).catch(function(){M(!a)})},O=function(a){z.loaded&&A(function(b){return q(p({},b),{data:q(p({},b.data),{userGamification:q(p({},b.data.userGamification),{userStreak:q(p({},b.data.userGamification.userStreak),{streakIncremented:a})})})})})},P=function(){var a,b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:i.kZ.HEADER;a=b,(0,f.Z)({url:"/api/user/gamification/tour?tour_type=".concat(a),type:"PUT"}),z.loaded&&A(function(a){return q(p({},a),{data:{userGamification:p({},a.data.userGamification,b===i.kZ.FIRST_BREAK_INTACT?{viewedFirstIntactTour:!0}:b===i.kZ.HEADER?{viewedStreakTour:1}:{viewedIncrementTour:!0})}})})},Q=function(a){var c=a.monthRange,d=a.monthData,e=a.endDate,f=a.clear;return A(function(a){var g,h,i,j,k,l,m,n,o,s,t,u,v,w,x;return q(p({},a),{data:{userGamification:q(p({},null===(g=a.data)|| void 0===g?void 0:g.userGamification),{userStreak:q(p({},null===(h=a.data)|| void 0===h?void 0:null===(i=h.userGamification)|| void 0===i?void 0:i.userStreak),{monthlyData:p({},f?{data:{},endDate:"",queriedMonths:new Set}:{data:p({},null===(j=a.data)|| void 0===j?void 0:null===(k=j.userGamification)|| void 0===k?void 0:null===(l=k.userStreak)|| void 0===l?void 0:null===(m=l.monthlyData)|| void 0===m?void 0:m.data,d),endDate:e||(null===(n=a.data)|| void 0===n?void 0:null===(o=n.userGamification)|| void 0===o?void 0:null===(s=o.userStreak)|| void 0===s?void 0:null===(t=s.monthlyData)|| void 0===t?void 0:t.endDate),queriedMonths:new Set(r(Array.from(null!==(b=null===(u=a.data)|| void 0===u?void 0:null===(v=u.userGamification)|| void 0===v?void 0:null===(w=v.userStreak)|| void 0===w?void 0:null===(x=w.monthlyData)|| void 0===x?void 0:x.queriedMonths)&& void 0!==b?b:[])).concat([c,]))})})})}})})},R=function(){return new Date().setHours(1,0,0,0)>z.data.userGamification.lastFetchTime.setHours(1,0,0,0)};return(0,d.jsx)(v.Provider,{value:{value:z,clearState:function(){A(p({},t))},load:function(a,b){return L(a,!1,b)},incrementStreak:function(a){var b=a.userInfo,c=a.userGamificationFeatureFlag,d=a.callBack;return L(b,!0,c,d)},setStreakTour:P,updateStreakIncrementedFlag:O,updateEnableStreaksFlag:N,updateMonthlyStreaks:Q,isStreakInfoOutdated:R,setLearningTrackerGoal:F,deleteLearningTracker:G,setLearningTrackerReminder:H,disableLearningTrackerReminder:I},children:w})}}}])
//# sourceMappingURL=https://js.educative.io/static/_next/sourcemaps/static/chunks/76707.b6723309834f8ccb.js.map